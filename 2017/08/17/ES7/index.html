<!DOCTYPE html>
<html lang="zh-Hans">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="ä¸ä¼šæè‰ºæœ¯çš„ç¨‹åºå‘˜ä¸æ˜¯å¥½è®¾è®¡å¸ˆ">
    

    <!--Author-->
    
        <meta name="author" content="hk">
    

    <!-- Title -->
    
    <title>asyncå’Œawait | HK&#39;s blog</title>

    <!-- Bootstrap Core CSS -->
    <link href="//cdn.bootcss.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Custom Fonts -->
    <link href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Noto+Serif:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>

    <!-- Content -->
    <section class="article-container">
<!-- Back Home -->
<a class="nav-back" href="/">
    <i class="fa fa-puzzle-piece"></i>
</a>

<!-- Page Header -->
<header class="intro-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>asyncå’Œawait</h1>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <!-- Post Main Content -->
            <div class="post-content col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <h1 id="asyncå’Œawaitåœ¨å¹²ä»€ä¹ˆ"><a href="#asyncå’Œawaitåœ¨å¹²ä»€ä¹ˆ" class="headerlink" title="asyncå’Œawaitåœ¨å¹²ä»€ä¹ˆ"></a>asyncå’Œawaitåœ¨å¹²ä»€ä¹ˆ</h1><p>ä»»æ„ä¸€ä¸ªåç§°éƒ½æ˜¯æœ‰æ„ä¹‰çš„ï¼Œå…ˆä»å­—é¢æ„æ€æ¥ç†è§£ã€‚async æ˜¯â€œå¼‚æ­¥â€çš„ç®€å†™ï¼Œè€Œ await å¯ä»¥è®¤ä¸ºæ˜¯ async wait çš„ç®€å†™ã€‚æ‰€ä»¥åº”è¯¥å¾ˆå¥½ç†è§£ async ç”¨äºç”³æ˜ä¸€ä¸ª function æ˜¯å¼‚æ­¥çš„ï¼Œè€Œ await ç”¨äºç­‰å¾…ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•æ‰§è¡Œå®Œæˆã€‚</p>
<p>å¦å¤–è¿˜æœ‰ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„è¯­æ³•è§„å®šï¼Œawait åªèƒ½å‡ºç°åœ¨ async å‡½æ•°ä¸­ã€‚ç„¶åç»†å¿ƒçš„æœ‹å‹ä¼šäº§ç”Ÿä¸€ä¸ªç–‘é—®ï¼Œå¦‚æœ await åªèƒ½å‡ºç°åœ¨ async å‡½æ•°ä¸­ï¼Œé‚£è¿™ä¸ª async å‡½æ•°åº”è¯¥æ€ä¹ˆè°ƒç”¨ï¼Ÿ</p>
<p>å¦‚æœéœ€è¦é€šè¿‡ await æ¥è°ƒç”¨ä¸€ä¸ª async å‡½æ•°ï¼Œé‚£è¿™ä¸ªè°ƒç”¨çš„å¤–é¢å¿…é¡»å¾—å†åŒ…ä¸€ä¸ª async å‡½æ•°ï¼Œç„¶åâ€¦â€¦è¿›å…¥æ­»å¾ªç¯ï¼Œæ°¸æ— å‡ºå¤´ä¹‹æ—¥â€¦â€¦</p>
<p>å¦‚æœ async å‡½æ•°ä¸éœ€è¦ await æ¥è°ƒç”¨ï¼Œé‚£ async åˆ°åº•èµ·ä¸ªå•¥ä½œç”¨ï¼Ÿ</p>
<h1 id="asyncèµ·ä»€ä¹ˆä½œç”¨"><a href="#asyncèµ·ä»€ä¹ˆä½œç”¨" class="headerlink" title="asyncèµ·ä»€ä¹ˆä½œç”¨"></a>asyncèµ·ä»€ä¹ˆä½œç”¨</h1><p>è¿™ä¸ªé—®é¢˜çš„å…³é”®åœ¨äºï¼Œasync å‡½æ•°æ˜¯æ€ä¹ˆå¤„ç†å®ƒçš„è¿”å›å€¼çš„ï¼</p>
<p>æˆ‘ä»¬å½“ç„¶å¸Œæœ›å®ƒèƒ½ç›´æ¥é€šè¿‡ <code>return</code> è¯­å¥è¿”å›æˆ‘ä»¬æƒ³è¦çš„å€¼ï¼Œä½†æ˜¯å¦‚æœçœŸæ˜¯è¿™æ ·ï¼Œä¼¼ä¹å°±æ²¡ await ä»€ä¹ˆäº‹äº†ã€‚æ‰€ä»¥ï¼Œå†™æ®µä»£ç æ¥è¯•è¯•ï¼Œçœ‹å®ƒåˆ°åº•ä¼šè¿”å›ä»€ä¹ˆï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">async function testAsync() &#123;</span><br><span class="line">    return &quot;hello async&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const result = testAsync();</span><br><span class="line">console.log(result);</span><br></pre></td></tr></table></figure>
<p>çœ‹åˆ°è¾“å‡ºå°±æç„¶å¤§æ‚Ÿäº†â€”â€”è¾“å‡ºçš„æ˜¯ä¸€ä¸ª Promise å¯¹è±¡ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">c:\var\test&gt; node --harmony_async_await .</span><br><span class="line">Promise &#123; &apos;hello async&apos; &#125;</span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥ï¼Œasync å‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ª Promise å¯¹è±¡ã€‚ä»æ–‡æ¡£ä¸­ä¹Ÿå¯ä»¥å¾—åˆ°è¿™ä¸ªä¿¡æ¯ã€‚async å‡½æ•°ï¼ˆåŒ…å«å‡½æ•°è¯­å¥ã€å‡½æ•°è¡¨è¾¾å¼ã€Lambdaè¡¨è¾¾å¼ï¼‰ä¼šè¿”å›ä¸€ä¸ª Promise å¯¹è±¡ï¼Œå¦‚æœåœ¨å‡½æ•°ä¸­ <code>return</code> ä¸€ä¸ªç›´æ¥é‡ï¼Œasync ä¼šæŠŠè¿™ä¸ªç›´æ¥é‡é€šè¿‡ <code>Promise.resolve()</code> å°è£…æˆ Promise å¯¹è±¡ã€‚</p>
<p>async å‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ª Promise å¯¹è±¡ï¼Œæ‰€ä»¥åœ¨æœ€å¤–å±‚ä¸èƒ½ç”¨ await è·å–å…¶è¿”å›å€¼çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å½“ç„¶åº”è¯¥ç”¨åŸæ¥çš„æ–¹å¼ï¼š<code>then()</code> é“¾æ¥å¤„ç†è¿™ä¸ª Promise å¯¹è±¡ï¼Œå°±åƒè¿™æ ·</p>
<p>ç°åœ¨å›è¿‡å¤´æ¥æƒ³ä¸‹ï¼Œå¦‚æœ async å‡½æ•°æ²¡æœ‰è¿”å›å€¼ï¼Œåˆè¯¥å¦‚ä½•ï¼Ÿå¾ˆå®¹æ˜“æƒ³åˆ°ï¼Œå®ƒä¼šè¿”å› Promise.resolve(undefined)ã€‚</p>
<p>è”æƒ³ä¸€ä¸‹ Promise çš„ç‰¹ç‚¹â€”â€”æ— ç­‰å¾…ï¼Œæ‰€ä»¥åœ¨æ²¡æœ‰ await çš„æƒ…å†µä¸‹æ‰§è¡Œ async å‡½æ•°ï¼Œå®ƒä¼šç«‹å³æ‰§è¡Œï¼Œè¿”å›ä¸€ä¸ª Promise å¯¹è±¡ï¼Œå¹¶ä¸”ï¼Œç»ä¸ä¼šé˜»å¡åé¢çš„è¯­å¥ã€‚è¿™å’Œæ™®é€šè¿”å› Promise å¯¹è±¡çš„å‡½æ•°å¹¶æ— äºŒè‡´ã€‚</p>
<p>é‚£ä¹ˆä¸‹ä¸€ä¸ªå…³é”®ç‚¹å°±åœ¨äº await å…³é”®å­—äº†ã€‚</p>
<h1 id="await-åˆ°åº•åœ¨ç­‰å•¥"><a href="#await-åˆ°åº•åœ¨ç­‰å•¥" class="headerlink" title="await åˆ°åº•åœ¨ç­‰å•¥"></a>await åˆ°åº•åœ¨ç­‰å•¥</h1><p>ä¸€èˆ¬æ¥è¯´ï¼Œéƒ½è®¤ä¸º await æ˜¯åœ¨ç­‰å¾…ä¸€ä¸ª async å‡½æ•°å®Œæˆã€‚ä¸è¿‡æŒ‰è¯­æ³•è¯´æ˜ï¼Œawait ç­‰å¾…çš„æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œè¿™ä¸ªè¡¨è¾¾å¼çš„è®¡ç®—ç»“æœæ˜¯ Promise å¯¹è±¡æˆ–è€…å…¶å®ƒå€¼ï¼ˆæ¢å¥è¯è¯´ï¼Œå°±æ˜¯æ²¡æœ‰ç‰¹æ®Šé™å®šï¼‰ã€‚</p>
<p>å› ä¸º async å‡½æ•°è¿”å›ä¸€ä¸ª Promise å¯¹è±¡ï¼Œæ‰€ä»¥ await å¯ä»¥ç”¨äºç­‰å¾…ä¸€ä¸ª async å‡½æ•°çš„è¿”å›å€¼â€”â€”è¿™ä¹Ÿå¯ä»¥è¯´æ˜¯ await åœ¨ç­‰ async å‡½æ•°ï¼Œä½†è¦æ¸…æ¥šï¼Œå®ƒç­‰çš„å®é™…æ˜¯ä¸€ä¸ªè¿”å›å€¼ã€‚æ³¨æ„åˆ° await ä¸ä»…ä»…ç”¨äºç­‰ Promise å¯¹è±¡ï¼Œå®ƒå¯ä»¥ç­‰ä»»æ„è¡¨è¾¾å¼çš„ç»“æœï¼Œæ‰€ä»¥ï¼Œawait åé¢å®é™…æ˜¯å¯ä»¥æ¥æ™®é€šå‡½æ•°è°ƒç”¨æˆ–è€…ç›´æ¥é‡çš„ã€‚æ‰€ä»¥ä¸‹é¢è¿™ä¸ªç¤ºä¾‹å®Œå…¨å¯ä»¥æ­£ç¡®è¿è¡Œ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function getSomething() &#123;</span><br><span class="line">    return &quot;something&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">async function testAsync() &#123;</span><br><span class="line">    return Promise.resolve(&quot;hello async&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">async function test() &#123;</span><br><span class="line">    const v1 = await getSomething();</span><br><span class="line">    const v2 = await testAsync();</span><br><span class="line">    console.log(v1, v2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test();</span><br></pre></td></tr></table></figure>
<h1 id="await-ç­‰åˆ°äº†è¦ç­‰çš„ï¼Œç„¶åå‘¢"><a href="#await-ç­‰åˆ°äº†è¦ç­‰çš„ï¼Œç„¶åå‘¢" class="headerlink" title="await ç­‰åˆ°äº†è¦ç­‰çš„ï¼Œç„¶åå‘¢"></a>await ç­‰åˆ°äº†è¦ç­‰çš„ï¼Œç„¶åå‘¢</h1><p>await ç­‰åˆ°äº†å®ƒè¦ç­‰çš„ä¸œè¥¿ï¼Œä¸€ä¸ª Promise å¯¹è±¡ï¼Œæˆ–è€…å…¶å®ƒå€¼ï¼Œç„¶åå‘¢ï¼Ÿæˆ‘ä¸å¾—ä¸å…ˆè¯´ï¼Œawait æ˜¯ä¸ªè¿ç®—ç¬¦ï¼Œç”¨äºç»„æˆè¡¨è¾¾å¼ï¼Œawait è¡¨è¾¾å¼çš„è¿ç®—ç»“æœå–å†³äºå®ƒç­‰çš„ä¸œè¥¿ã€‚</p>
<p>å¦‚æœå®ƒç­‰åˆ°çš„ä¸æ˜¯ä¸€ä¸ª Promise å¯¹è±¡ï¼Œé‚£ await è¡¨è¾¾å¼çš„è¿ç®—ç»“æœå°±æ˜¯å®ƒç­‰åˆ°çš„ä¸œè¥¿ã€‚</p>
<p>å¦‚æœå®ƒç­‰åˆ°çš„æ˜¯ä¸€ä¸ª Promise å¯¹è±¡ï¼Œawait å°±å¿™èµ·æ¥äº†ï¼Œå®ƒä¼šé˜»å¡åé¢çš„ä»£ç ï¼Œç­‰ç€ Promise å¯¹è±¡ resolveï¼Œç„¶åå¾—åˆ° resolve çš„å€¼ï¼Œä½œä¸º await è¡¨è¾¾å¼çš„è¿ç®—ç»“æœã€‚</p>
<p>çœ‹åˆ°ä¸Šé¢çš„é˜»å¡ä¸€è¯ï¼Œå¿ƒæ…Œäº†å§â€¦â€¦æ”¾å¿ƒï¼Œè¿™å°±æ˜¯ await å¿…é¡»ç”¨åœ¨ async å‡½æ•°ä¸­çš„åŸå› ã€‚async å‡½æ•°è°ƒç”¨ä¸ä¼šé€ æˆé˜»å¡ï¼Œå®ƒå†…éƒ¨æ‰€æœ‰çš„é˜»å¡éƒ½è¢«å°è£…åœ¨ä¸€ä¸ª Promise å¯¹è±¡ä¸­å¼‚æ­¥æ‰§è¡Œã€‚</p>
<h1 id="async-await-å¸®æˆ‘ä»¬å¹²äº†å•¥"><a href="#async-await-å¸®æˆ‘ä»¬å¹²äº†å•¥" class="headerlink" title="async/await å¸®æˆ‘ä»¬å¹²äº†å•¥"></a>async/await å¸®æˆ‘ä»¬å¹²äº†å•¥</h1><p>ä¸Šé¢å·²ç»è¯´æ˜äº† async ä¼šå°†å…¶åçš„å‡½æ•°ï¼ˆå‡½æ•°è¡¨è¾¾å¼æˆ– Lambdaï¼‰çš„è¿”å›å€¼å°è£…æˆä¸€ä¸ª Promise å¯¹è±¡ï¼Œè€Œ await ä¼šç­‰å¾…è¿™ä¸ª Promise å®Œæˆï¼Œå¹¶å°†å…¶ resolve çš„ç»“æœè¿”å›å‡ºæ¥ã€‚</p>
<p>ç°åœ¨ä¸¾ä¾‹ï¼Œç”¨ <code>setTimeout</code> æ¨¡æ‹Ÿè€—æ—¶çš„å¼‚æ­¥æ“ä½œï¼Œå…ˆæ¥çœ‹çœ‹ä¸ç”¨ async/await ä¼šæ€ä¹ˆå†™</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function takeLongTime() &#123;</span><br><span class="line">    return new Promise(resolve =&gt; &#123;</span><br><span class="line">        setTimeout(() =&gt; resolve(&quot;long_time_value&quot;), 1000);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">takeLongTime().then(v =&gt; &#123;</span><br><span class="line">    console.log(&quot;got&quot;, v);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæ”¹ç”¨ async/await å‘¢ï¼Œä¼šæ˜¯è¿™æ ·</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function takeLongTime() &#123;</span><br><span class="line">    return new Promise(resolve =&gt; &#123;</span><br><span class="line">        setTimeout(() =&gt; resolve(&quot;long_time_value&quot;), 1000);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">async function test() &#123;</span><br><span class="line">    const v = await takeLongTime();</span><br><span class="line">    console.log(v);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test();</span><br></pre></td></tr></table></figure>
<p>çœ¼å°–çš„åŒå­¦å·²ç»å‘ç° <code>takeLongTime()</code> æ²¡æœ‰ç”³æ˜ä¸º <code>async</code>ã€‚å®é™…ä¸Šï¼Œ<code>takeLongTime()</code> æœ¬èº«å°±æ˜¯è¿”å›çš„ Promise å¯¹è±¡ï¼ŒåŠ ä¸åŠ  <code>async</code> ç»“æœéƒ½ä¸€æ ·ï¼Œå¦‚æœæ²¡æ˜ç™½ï¼Œè¯·å›è¿‡å¤´å†å»çœ‹çœ‹ä¸Šé¢çš„â€œasync èµ·ä»€ä¹ˆä½œç”¨â€ã€‚</p>
<p>åˆä¸€ä¸ªç–‘é—®äº§ç”Ÿäº†ï¼Œè¿™ä¸¤æ®µä»£ç ï¼Œä¸¤ç§æ–¹å¼å¯¹å¼‚æ­¥è°ƒç”¨çš„å¤„ç†ï¼ˆå®é™…å°±æ˜¯å¯¹ Promise å¯¹è±¡çš„å¤„ç†ï¼‰å·®åˆ«å¹¶ä¸æ˜æ˜¾ï¼Œç”šè‡³ä½¿ç”¨ async/await è¿˜éœ€è¦å¤šå†™ä¸€äº›ä»£ç ï¼Œé‚£å®ƒçš„ä¼˜åŠ¿åˆ°åº•åœ¨å“ªï¼Ÿ</p>
<h1 id="async-await-çš„ä¼˜åŠ¿åœ¨äºå¤„ç†-thené“¾"><a href="#async-await-çš„ä¼˜åŠ¿åœ¨äºå¤„ç†-thené“¾" class="headerlink" title="async/await çš„ä¼˜åŠ¿åœ¨äºå¤„ç† thené“¾"></a>async/await çš„ä¼˜åŠ¿åœ¨äºå¤„ç† thené“¾</h1><p>å•ä¸€çš„ Promise é“¾å¹¶ä¸èƒ½å‘ç° async/await çš„ä¼˜åŠ¿ï¼Œä½†æ˜¯ï¼Œå¦‚æœéœ€è¦å¤„ç†ç”±å¤šä¸ª Promise ç»„æˆçš„ then é“¾çš„æ—¶å€™ï¼Œä¼˜åŠ¿å°±èƒ½ä½“ç°å‡ºæ¥äº†ï¼ˆå¾ˆæœ‰æ„æ€ï¼ŒPromise é€šè¿‡ then é“¾æ¥è§£å†³å¤šå±‚å›è°ƒçš„é—®é¢˜ï¼Œç°åœ¨åˆç”¨ async/await æ¥è¿›ä¸€æ­¥ä¼˜åŒ–å®ƒï¼‰ã€‚</p>
<p>å‡è®¾ä¸€ä¸ªä¸šåŠ¡ï¼Œåˆ†å¤šä¸ªæ­¥éª¤å®Œæˆï¼Œæ¯ä¸ªæ­¥éª¤éƒ½æ˜¯å¼‚æ­¥çš„ï¼Œè€Œä¸”ä¾èµ–äºä¸Šä¸€ä¸ªæ­¥éª¤çš„ç»“æœã€‚æˆ‘ä»¬ä»ç„¶ç”¨ setTimeout æ¥æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * ä¼ å…¥å‚æ•° nï¼Œè¡¨ç¤ºè¿™ä¸ªå‡½æ•°æ‰§è¡Œçš„æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span><br><span class="line"> * æ‰§è¡Œçš„ç»“æœæ˜¯ n + 200ï¼Œè¿™ä¸ªå€¼å°†ç”¨äºä¸‹ä¸€æ­¥éª¤</span><br><span class="line"> */</span><br><span class="line">function takeLongTime(n) &#123;</span><br><span class="line">    return new Promise(resolve =&gt; &#123;</span><br><span class="line">        setTimeout(() =&gt; resolve(n + 200), n);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function step1(n) &#123;</span><br><span class="line">    console.log(`step1 with $&#123;n&#125;`);</span><br><span class="line">    return takeLongTime(n);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function step2(n) &#123;</span><br><span class="line">    console.log(`step2 with $&#123;n&#125;`);</span><br><span class="line">    return takeLongTime(n);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function step3(n) &#123;</span><br><span class="line">    console.log(`step3 with $&#123;n&#125;`);</span><br><span class="line">    return takeLongTime(n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨ç”¨ Promise æ–¹å¼æ¥å®ç°è¿™ä¸‰ä¸ªæ­¥éª¤çš„å¤„ç†</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">function doIt() &#123;</span><br><span class="line">    console.time(&quot;doIt&quot;);</span><br><span class="line">    const time1 = 300;</span><br><span class="line">    step1(time1)</span><br><span class="line">        .then(time2 =&gt; step2(time2))</span><br><span class="line">        .then(time3 =&gt; step3(time3))</span><br><span class="line">        .then(result =&gt; &#123;</span><br><span class="line">            console.log(`result is $&#123;result&#125;`);</span><br><span class="line">            console.timeEnd(&quot;doIt&quot;);</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">doIt();</span><br><span class="line"></span><br><span class="line">// c:\var\test&gt;node --harmony_async_await .</span><br><span class="line">// step1 with 300</span><br><span class="line">// step2 with 500</span><br><span class="line">// step3 with 700</span><br><span class="line">// result is 900</span><br><span class="line">// doIt: 1507.251ms</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºç»“æœ result æ˜¯ step3() çš„å‚æ•° 700 + 200 = 900ã€‚doIt() é¡ºåºæ‰§è¡Œäº†ä¸‰ä¸ªæ­¥éª¤ï¼Œä¸€å…±ç”¨äº† 300 + 500 + 700 = 1500 æ¯«ç§’ï¼Œå’Œ console.time()/console.timeEnd() è®¡ç®—çš„ç»“æœä¸€è‡´ã€‚</p>
<p>å¦‚æœç”¨ async/await æ¥å®ç°å‘¢ï¼Œä¼šæ˜¯è¿™æ ·</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">async function doIt() &#123;</span><br><span class="line">    console.time(&quot;doIt&quot;);</span><br><span class="line">    const time1 = 300;</span><br><span class="line">    const time2 = await step1(time1);</span><br><span class="line">    const time3 = await step2(time2);</span><br><span class="line">    const result = await step3(time3);</span><br><span class="line">    console.log(`result is $&#123;result&#125;`);</span><br><span class="line">    console.timeEnd(&quot;doIt&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">doIt();</span><br></pre></td></tr></table></figure>
<p>ç»“æœå’Œä¹‹å‰çš„ Promise å®ç°æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯è¿™ä¸ªä»£ç çœ‹èµ·æ¥æ˜¯ä¸æ˜¯æ¸…æ™°å¾—å¤šï¼Œå‡ ä¹è·ŸåŒæ­¥ä»£ç ä¸€æ ·</p>
<h1 id="è¿˜æœ‰æ›´é…·çš„"><a href="#è¿˜æœ‰æ›´é…·çš„" class="headerlink" title="è¿˜æœ‰æ›´é…·çš„"></a>è¿˜æœ‰æ›´é…·çš„</h1><p>ç°åœ¨æŠŠä¸šåŠ¡è¦æ±‚æ”¹ä¸€ä¸‹ï¼Œä»ç„¶æ˜¯ä¸‰ä¸ªæ­¥éª¤ï¼Œä½†æ¯ä¸€ä¸ªæ­¥éª¤éƒ½éœ€è¦ä¹‹å‰æ¯ä¸ªæ­¥éª¤çš„ç»“æœã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function step1(n) &#123;</span><br><span class="line">    console.log(`step1 with $&#123;n&#125;`);</span><br><span class="line">    return takeLongTime(n);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function step2(m, n) &#123;</span><br><span class="line">    console.log(`step2 with $&#123;m&#125; and $&#123;n&#125;`);</span><br><span class="line">    return takeLongTime(m + n);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function step3(k, m, n) &#123;</span><br><span class="line">    console.log(`step3 with $&#123;k&#125;, $&#123;m&#125; and $&#123;n&#125;`);</span><br><span class="line">    return takeLongTime(k + m + n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™å›å…ˆç”¨ async/await æ¥å†™ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">async function doIt() &#123;</span><br><span class="line">    console.time(&quot;doIt&quot;);</span><br><span class="line">    const time1 = 300;</span><br><span class="line">    const time2 = await step1(time1);</span><br><span class="line">    const time3 = await step2(time1, time2);</span><br><span class="line">    const result = await step3(time1, time2, time3);</span><br><span class="line">    console.log(`result is $&#123;result&#125;`);</span><br><span class="line">    console.timeEnd(&quot;doIt&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">doIt();</span><br><span class="line"></span><br><span class="line">// c:\var\test&gt;node --harmony_async_await .</span><br><span class="line">// step1 with 300</span><br><span class="line">// step2 with 800 = 300 + 500</span><br><span class="line">// step3 with 1800 = 300 + 500 + 1000</span><br><span class="line">// result is 2000</span><br><span class="line">// doIt: 2907.387ms</span><br></pre></td></tr></table></figure>
<p>é™¤äº†è§‰å¾—æ‰§è¡Œæ—¶é—´å˜é•¿äº†ä¹‹å¤–ï¼Œä¼¼ä¹å’Œä¹‹å‰çš„ç¤ºä¾‹æ²¡å•¥åŒºåˆ«å•Šï¼åˆ«æ€¥ï¼Œè®¤çœŸæƒ³æƒ³å¦‚æœæŠŠå®ƒå†™æˆ Promise æ–¹å¼å®ç°ä¼šæ˜¯ä»€ä¹ˆæ ·å­ï¼Ÿ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">function doIt() &#123;</span><br><span class="line">    console.time(&quot;doIt&quot;);</span><br><span class="line">    const time1 = 300;</span><br><span class="line">    step1(time1)</span><br><span class="line">        .then(time2 =&gt; &#123;</span><br><span class="line">            return step2(time1, time2)</span><br><span class="line">                .then(time3 =&gt; [time1, time2, time3]);</span><br><span class="line">        &#125;)</span><br><span class="line">        .then(times =&gt; &#123;</span><br><span class="line">            const [time1, time2, time3] = times;</span><br><span class="line">            return step3(time1, time2, time3);</span><br><span class="line">        &#125;)</span><br><span class="line">        .then(result =&gt; &#123;</span><br><span class="line">            console.log(`result is $&#123;result&#125;`);</span><br><span class="line">            console.timeEnd(&quot;doIt&quot;);</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">doIt();</span><br></pre></td></tr></table></figure>
<p>æœ‰æ²¡æœ‰æ„Ÿè§‰æœ‰ç‚¹å¤æ‚çš„æ ·å­ï¼Ÿé‚£ä¸€å †å‚æ•°å¤„ç†ï¼Œå°±æ˜¯ Promise æ–¹æ¡ˆçš„æ­»ç©´â€”â€” å‚æ•°ä¼ é€’å¤ªéº»çƒ¦äº†ï¼Œçœ‹ç€å°±æ™•ï¼</p>
<h1 id="æ´—æ´—ç¡å§"><a href="#æ´—æ´—ç¡å§" class="headerlink" title="æ´—æ´—ç¡å§"></a>æ´—æ´—ç¡å§</h1><p>å°±ç›®å‰æ¥è¯´ï¼Œå·²ç»ç†è§£ async/await äº†å§ï¼Ÿä½†å…¶å®è¿˜æœ‰ä¸€äº›äº‹æƒ…æ²¡æåŠâ€”â€”Promise æœ‰å¯èƒ½ reject å•Šï¼Œæ€ä¹ˆå¤„ç†å‘¢ï¼Ÿå¦‚æœéœ€è¦å¹¶è¡Œå¤„ç†3ä¸ªæ­¥éª¤ï¼Œå†ç­‰å¾…æ‰€æœ‰ç»“æœï¼Œåˆè¯¥æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ</p>
<p>é˜®ä¸€å³°è€å¸ˆåœ¨<a href="https://www.baidu.com/link?url=uVsvXLODNwU5R03X0Ka30MXwjUBkTo1vmdQiEbWQFUHPPZ4sQZT7YSaUnl0_Nbjk&amp;wd=&amp;eqid=de609cd1000075cb000000065999be80" target="_blank" rel="noopener">ECMAScript 6å…¥é—¨</a>å·²ç»è¯´è¿‡äº†ï¼Œæˆ‘å°±æ‡’å¾—è¯´äº†ã€‚</p>

 
                <!-- Meta -->
                <div class="post-meta">
                    <hr>
                    <br>
                    <div class="post-tags">
                        
                            

<a href="/tags/æ•™ç¨‹/">#æ•™ç¨‹</a>


                        
                    </div>
                    <div class="post-date">
                        2017 å¹´ 08 æœˆ 17 æ—¥
                    </div>
                </div>
            </div>

            <!-- Comments -->
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <!-- Disqus Comments -->


            </div>
        </div>
    </div>
</article>
</section>

    <!-- Scripts -->
    <!-- jQuery -->
<script src="//cdn.bootcss.com/jquery/2.2.1/jquery.min.js"></script>
<!-- Bootstrap -->
<script src="//cdn.bootcss.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

<script type="text/javascript">
	console.log('Hexo-theme-hollow designed by zchen9 ğŸ™‹ Â© 2015-' + (new Date()).getFullYear());
</script>

    <!-- Google Analytics -->
    

</body>

</html>